from src import utils, scanner
import pytest


def test_get_repo_name_from_url():
    repo_name = utils.get_repo_name_from_url(
        "https://github.com/invertase/react-native-firebase/"
    )
    assert repo_name == utils.get_repo_name_from_url(
        "https://github.com/invertase/react-native-firebase"
    )  # without trailing slash

    assert repo_name == "invertase/react-native-firebase"


def test_issue_class():
    """test that risk can't get a value bigger than 100 / smaller than 0"""
    with pytest.raises(ValueError):
        issue = scanner.Issue(title="test", body="test", risk=-1)
    with pytest.raises(ValueError):
        issue = scanner.Issue(title="test", body="test", risk=101)


def test_calculate_risk():
    issue1 = {"title": "test", "score": 5}
    issue2 = {"title": "test", "score": 0.5}
    assert scanner.calculate_risk(issue1, 5) == 5  # shouldn't change the factor
    assert scanner.calculate_risk(issue2, 5) == 5 * 0.5  # shouldn't change the factor


# TODO async tests (mock responses)
